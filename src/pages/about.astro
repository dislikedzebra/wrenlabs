---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<BaseHead title="Wrenlabs Terminal" description="A tech lab by Nathan Wren" />

<div class="bg-black text-green-400 font-mono min-h-screen flex flex-col">
  <Header />

  <main class="flex-1 p-6 max-w-4xl mx-auto">
    <div id="terminal" class="bg-black border border-green-600 p-6 rounded-lg shadow-lg whitespace-pre-wrap">
      <div>Wrenlabs v1.0.0</div>
      <div>&nbsp;</div>
      <div>> Welcome to the Wrenlabs terminal.</div>
      <div>> Type <span class="text-yellow-400">'help'</span> to see available commands.</div>
      <div>&nbsp;</div>
      <div class="command-line flex items-center">
        <span>&gt; </span><span id="input" contenteditable="true" class="outline-none ml-1"></span><span class="blink">█</span>
      </div>
    </div>
  </main>

  <Footer />
</div>

<style>
  .blink {
    animation: blink 1s step-start 0s infinite;
  }
  @keyframes blink {
    50% {
      opacity: 0;
    }
  }
</style>

<script is:inline>
  const terminal = document.getElementById('terminal');
  let input = document.getElementById('input');

  const commands = {
    help: "Available commands:\\n - projects\\n - about\\n - clear",
    projects: "Check out:\\n - /projects/homelab\\n - /projects/portfolio-site\\n - /projects/k8s-lab",
    about: "Nathan Wren — Tech enthusiast, sysadmin, and builder of Wrenlabs.",
    clear: 'CLEAR'
  };

  input?.focus();
  document.addEventListener('click', () => input?.focus());

  document.addEventListener('keydown', function (e) {
    if (e.key === 'Enter' && input) {
      e.preventDefault();
      const cmdText = input.innerText.trim();

      const cmdDiv = document.createElement('div');
      cmdDiv.textContent = `> ${cmdText}`;
      terminal.appendChild(cmdDiv);

      const responseDiv = document.createElement('div');

      if (commands[cmdText]) {
        if (cmdText === 'clear') {
          terminal.innerHTML = `
            <div>Wrenlabs v1.0.0</div>
            <div>&nbsp;</div>
            <div>> Welcome to the Wrenlabs terminal.</div>
            <div>> Type <span class='text-yellow-400'>'help'</span> to see available commands.</div>
            <div>&nbsp;</div>
          `;
        } else {
          responseDiv.textContent = commands[cmdText];
          terminal.appendChild(responseDiv);
        }
      } else {
        responseDiv.textContent = \`Command not found: '\${cmdText}'. Try 'help'.\`;
        terminal.appendChild(responseDiv);
      }

      const newCmd = document.createElement('div');
      newCmd.className = 'command-line flex items-center';
      newCmd.innerHTML = `<span>> </span><span id="input" contenteditable="true" class="outline-none ml-1"></span><span class="blink">█</span>`;
      terminal.appendChild(newCmd);

      input = newCmd.querySelector('#input');
      input.focus();
      window.scrollTo(0, document.body.scrollHeight);
    }
  });
</script>
